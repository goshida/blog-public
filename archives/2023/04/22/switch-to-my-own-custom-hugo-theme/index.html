<!doctype html><html lang=ja><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q4NDL34NBB"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Q4NDL34NBB")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,user-scalable=yes"><title>Hugo のテーマを自作のものに切り替えた - SHIDALOG</title><meta name=author content="goshida"><meta name=description content="Hugo のテーマを自作してそれに切り替えたので、テーマ作って切り替えるまでを一通りやった感想など。"><meta name=generator content="Hugo 0.105.0"><meta property="og:title" content="Hugo のテーマを自作のものに切り替えた"><meta property="og:description" content="Hugo のテーマを自作してそれに切り替えたので、テーマ作って切り替えるまでを一通りやった感想など。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.shida-ws.net/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/"><meta property="article:section" content="archives"><meta property="article:published_time" content="2023-04-23T20:07:07+09:00"><meta property="article:modified_time" content="2023-04-23T20:07:07+09:00"><link rel=stylesheet href=https://blog.shida-ws.net/css/style.css><link rel=stylesheet href=https://blog.shida-ws.net/css/custom.css><body><div class=site_container><header class=site_header_container><div class="header_container content_area"><div class=header_body><div class=logo_container><div class=site_logo><a href=https://blog.shida-ws.net/>SHIDALOG</a></div><div class=site_tagline>備忘録的なもの</div></div><nav class=site_navigation_container><ul class=navigation_list><li class=navigation_item><a href=/archives/>Archives</a></li><li class=navigation_item><a href=/about/>About</a></li><li class=navigation_item><a href=/policy/>Policy</a></li></ul></nav></div></div></header><div class=site_main_container><div class="single_container content_area"><div class=single_main_container itemscope itemtype=https://schema.org/BlogPosting><main class="article_main_container card"><article class=article_container><header class=article_header><h1 class=article_title itemprop=headline>Hugo のテーマを自作のものに切り替えた</h1></header><section class=article_body itemprop=articleBody><p>Hugo のテーマを自作してそれに切り替えたので、テーマ作って切り替えるまでを一通りやった感想など。</p><p>以前 <a href=http://localhost:1313/archives/2023/03/02/create-a-hugo-theme/>Hugoのテーマ自作するぞという記事</a> を書いてからだいぶ時間が空いてしまったが、
一応テーマを作って切り替える所までこぎつけることができた。</p><p>最初は知見などをまとめるつもりだったのだが、今の所 Hugo のドキュメントに書いてあることを理解する以外でそれほど詰まってはなく、
知見という形でまとめられそうに無かったので感想の形でまとめる。</p><h2 id=作ったもの>作ったもの</h2><p>作ったものは GitHub に置いている。</p><p><a href=https://github.com/goshida/hugo-theme>goshida/hugo-theme</a></p><p>ファイルとしてはこんな感じで、そんなに凝った作りでは無いと思う。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>❯ tree --charset unicode themes/hugo-theme/
</span></span><span style=display:flex><span>themes/hugo-theme/
</span></span><span style=display:flex><span>|-- LICENSE
</span></span><span style=display:flex><span>|-- README.md
</span></span><span style=display:flex><span>|-- archetypes
</span></span><span style=display:flex><span>|   <span style=color:#a5d6ff>`</span>-- default.md
</span></span><span style=display:flex><span>|-- layouts
</span></span><span style=display:flex><span>|   |-- 404.html
</span></span><span style=display:flex><span>|   |-- _default
</span></span><span style=display:flex><span>|   |   |-- baseof.html
</span></span><span style=display:flex><span>|   |   |-- list.html
</span></span><span style=display:flex><span>|   |   |-- single.html
</span></span><span style=display:flex><span>|   |   |-- sitemap.xml
</span></span><span style=display:flex><span>|   |   <span style=color:#a5d6ff>`</span>-- terms.html
</span></span><span style=display:flex><span>|   |-- index.html
</span></span><span style=display:flex><span>|   |-- partials
</span></span><span style=display:flex><span>|   |   |-- footer.html
</span></span><span style=display:flex><span>|   |   |-- head.html
</span></span><span style=display:flex><span>|   |   <span style=color:#a5d6ff>`</span>-- header.html
</span></span><span style=display:flex><span>|   <span style=color:#a5d6ff>`</span>-- robots.txt
</span></span><span style=display:flex><span>|-- static
</span></span><span style=display:flex><span>|   |-- css
</span></span><span style=display:flex><span>|   |   |-- custom.css
</span></span><span style=display:flex><span>|   |   <span style=color:#a5d6ff>`</span>-- style.css
</span></span><span style=display:flex><span>|   <span style=color:#a5d6ff>`</span>-- images
</span></span><span style=display:flex><span>|       |-- icon_calendar.svg
</span></span><span style=display:flex><span>|       |-- icon_folder.svg
</span></span><span style=display:flex><span>|       |-- icon_reload.svg
</span></span><span style=display:flex><span>|       <span style=color:#a5d6ff>`</span>-- icon_tag.svg
</span></span><span style=display:flex><span><span style=color:#a5d6ff>`</span>-- theme.toml
</span></span></code></pre></div><p>デザインに関してはサイト見たら分かる通りという感じだが、今後またテーマ弄ったときのために画像で貼り付けておく</p><figure><a href=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/homepage.webp target=_self><img src=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/homepage_hu09397a58d9bc09d3f2a9e25aa5ce3264_42198_640x600_fit_q75_h2_box_2.webp alt=トップページの画面キャプチャ></a><figcaption>トップページ</figcaption></figure><figure><a href=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/list.webp target=_self><img src=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/list_hu166d813d3b8b6e28499273a97eaab69e_53874_640x600_fit_q75_h2_box_2.webp alt=記事リストページの画面キャプチャ></a><figcaption>記事リストページ</figcaption></figure><figure><a href=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/single.webp target=_self><img src=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/single_hu8809e8ea470bd2df13f7913476ed278d_113102_640x600_fit_q75_h2_box_2.webp alt=個別記事ページの画面キャプチャ></a><figcaption>個別記事ページ</figcaption></figure><p>元々使っていたテーマ（ <a href=https://mainroad-demo.netlify.app/>Mainroad</a> ）で不満だった記事本文部分の幅が狭いとか、見出しの階層がわかりにくいとかも解消した。
デザインが今風かどうかは置いといて、個人的には見やすいと感じていて結構気に入っている。</p><p>あと javascript も使ってないし静的サイトという事情もあるので当然なのかもしれないが、
PageSpeed Insights でも良い点数出てくれて、こういうのは意外と嬉しい。</p><figure><a href=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/pagespeedinsights.webp target=_self><img src=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/pagespeedinsights_hu1ab459b6a045eefb717fb85fd6649e44_65250_480x480_fit_q75_h2_box_2.webp alt="PageSpeed Insights 評価の画面キャプチャ"></a><figcaption>PageSpeed Insghts での評価（キャプチャは省略するがモバイルも同じ点数）</figcaption></figure><h2 id=進め方についての反省点>進め方についての反省点</h2><p>作り始めた時点で HTML, CSS の理解が怪しかったり、 Hugo の文法とか変数とか関数も調べつつで、もう忘れてしまったこともある気はするのだが、
ああしとけばよかったこうしとけばよかったみたいな部分で印象に残っている部分をいくつかピックアップ。</p><p>ちなみに Hugo 固有のものよりは、HTML と CSS での記憶の方が強い。
Hugo に関してはとりあえず テンプレートのルックアップの仕組みだけ理解して、後はドキュメントで Variable と Function を都度調べる感じでなんとかなっている。
そもそもの理解が足りてなくて、まだああしてれば良かったこうしてれば良かったみたいなことを考える段階に居ないのかもしれない。</p><h3 id=テスト用のサイトについて>テスト用のサイトについて</h3><blockquote><p>既にこのブログでいくつか記事を書いているので、そのリポジトリでブランチ切って作っていくでも良い気はしたが、 別のテーマ用に行っている設定とごっちゃになって何かにハマりそうな気がしたため一旦公式サンプルサイトを使うことにした。</p></blockquote><p><a href=/archives/2023/03/02/create-a-hugo-theme/>以前の記事</a> で書いたとおり、
Hugo のサンプルサイトで表示を確認しながらテーマを作っていったのだが、
途中で試しに既存のサイトに当てて見た所、サンプルサイト使って最後まで作り切るのは若干微妙そうなことに気付いた。</p><ul><li>サンプルサイトにも Markdown 記法の確認ページはあるが、自分の使っている表現を全部網羅してるわけではない<ul><li>自作 shortcode の表示なども確認できない</li></ul></li><li>サンプルサイトの確認ページで問題なくても実際は表示が崩れる場合（自作 CSS の誤りに気付かない可能性）がある<ul><li>1行が超長いコードブロックではみ出た部分の表示とか</li><li>要素の中に要素を入れた場合（引用の中にテーブル入れたり）にどうなるかとか</li></ul></li><li>サンプルサイト内の記事数が多くない（5ページ）関係でページングの動作の確認がしにくい</li><li>サンプルサイトだと英語だけだが、日本語だと結構印象が変わるので、自サイトに当てる前に CSS の再調整が必要になる</li></ul><p>また、実際の所テンプレート書いていく中でサイトの設定（ <code>config.toml</code> ）がどう使われるか理解できるので、
別のテーマ用の設定が混ざってた所で変なハマり方することはなさそうと思ったのもある。</p><p>途中からはサンプルサイトは使わず、今のサイトのコンテンツで動作確認しながら進めていた。</p><p>後から考えるとという話ではあるが、最初から今のサイトのコンテンツで確認しながらテーマ作っていっても良かったなと思う。</p><h3 id=html-のシンタックス>HTML のシンタックス</h3><p>最初にガリガリ書いてる最中は Hugo のローカルサーバを起動してブラウザで見ながら、
「ちゃんと見えてるな、ヨシ」で作業してたのだが、切り替えてから W3C の評価ツールを通してみると色々出ていた。</p><ul><li><a href=https://validator.w3.org/nu/>Ready to check - Nu Html Checker</a></li></ul><p>具体的にどういうエラーが出ていたか記録してないのだが、
記憶に残ってるのは <code>&lt;dl></code> タグ内で <code>&lt;div></code> タグを使う際の制限。</p><p>こんな感じで <code>&lt;div></code> タグ一個なら問題ないのだが、</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#7ee787>dl</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>dt</span>&gt;hoge&lt;/<span style=color:#7ee787>dt</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>dd</span>&gt;fuga&lt;/<span style=color:#7ee787>dd</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>dl</span>&gt;
</span></span></code></pre></div><p>こんな感じでもう一個間に挟むと HTML 的には Invalid だった。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#7ee787>dl</span>&gt;
</span></span><span style=display:flex><span>  &lt;<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>dt</span>&gt;hoge&lt;/<span style=color:#7ee787>dt</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#7ee787>dd</span>&gt;fuga&lt;/<span style=color:#7ee787>dd</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>  &lt;/<span style=color:#7ee787>div</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#7ee787>dl</span>&gt;
</span></span></code></pre></div><p>ただブラウザ上だと普通に表示されてしまうこともあり、
Invalid であることに気付かず進めてしまっていて、実際に自作テーマでサイトをデプロイして評価ツールをかましたタイミングで気付いた。</p><p>後者の前提で（レスポンシブル的な変形含め） CSS も結構書いてしまっていたので、修正に結構手間取った。</p><p>普段からサイト作っている人だと当たり前なのかもしれないが、ちゃんと早い段階から評価ツールで確認しながら作っていけばよかったなと思う。</p><h3 id=機種依存の表示崩れのデバッグ>機種依存の表示崩れのデバッグ</h3><p>最初にテンプレートや CSS をイチからガリガリ書いてる最中の確認は前述の通りブラウザで見ていたが、環境としては GoogleChrome (Linux) でやっていた。</p><p>で、モバイル表示の確認も開発者ツールのモバイル表示機能を使ってやっていたのだが、
こっちでもいざ切り替えて iPhone で見てみるとコードブロックの表示が崩れるという状態になっていた。</p><figure><a href=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/iphone-codeblock.webp target=_self><img src=/archives/2023/04/22/switch-to-my-own-custom-hugo-theme/images/iphone-codeblock_hu641552b33fa40b0a1345722e160789d4_392830_640x640_fit_q75_h2_box_2.webp alt="iPhone でコードブロックの表示が崩れている画像"></a><figcaption>iPhone でコードブロックの表示が崩れている様子（上が SE2 で 下が 13mini）</figcaption></figure><p><a href=http://localhost:1313/archives/2023/02/20/disable-mouse-in-nvim/#mouse-%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6>以前書いたある記事</a> のコードブロックの表示だが、
1つのコードブロック内でフォントサイズがバラバラになっている。</p><p>Chrome(Linux) でも Firefox(Linux) でも Chrome(Android) でも問題なくて、 Safari(iOS) や Chrome(iOS) でだけ崩れる。
しかも端末によってで崩れ方が違うというよくわからない状態になっていた。</p><p>Mac が手元に無いので開発者ツールとかも使えなくてどうなってるのかがさっぱり分からず、フォントやフォントサイズを意図しない所から継承してきてるのか、
シンタックスハイライトで挿入された span タグと自前 CSS が何か干渉してるのか、とか色々試して解消までに結構な時間を使った。</p><p>最終的には CSS で body タグに <code>-webkit-text-size-adjust: 100%</code> の1行を足すことで解消したのだが、
MDN とかで説明読んでも未だになんでこういう崩れかたしたのかや、なんでこの1行で解消したのかは理解できてない。</p><p>こういう機種依存の問題をちゃんと把握して、簡単に崩れないサイトを作っている
世の Web フロントエンジニア（デザイナー？）は偉大というのを感じた。</p><p>ちなみにこの時に色々試す中で、 <code>--bind</code> と <code>--baseURL</code> を指定することで別端末からアクセスできる形で Hugo の server を起動できるのを知ったのだが、
これ知ってれば切り替える前に気付けてたかもなと思う。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>hugo server --bind 192.168.0.1 --baseURL<span style=color:#ff7b72;font-weight:700>=</span>http://192.168.0.1
</span></span></code></pre></div><h2 id=やり残したこと>やり残したこと</h2><p>切り替えに際しては、満足行くまで弄ってると無限に弄りたい部分が出てきて、
このままだといつまで経っても切り替えられないと感じたのである程度切りの良いタイミングで覚悟決めて切り替えた所がある。</p><p>そのためやりたいことは色々積んだままになっていて、今時点で思っていることとしてもこれくらいある。</p><ul><li>Google Analytics 対応</li><li>サイト内検索フォーム</li><li>SNS リンクアイコン<ul><li>とりあえず GitHub あたりから</li></ul></li><li>サイトメニューのモバイルサイトっぽいデザイン<ul><li>ハンバーガーボタンクリックしたらメニューが出てくるような奴</li></ul></li><li>モバイル表示での目次の表示方法<ul><li>PC表示だと目次をスクロールに追従する様にしているが、モバイル表示だと良い感じのデザインが思いつかず記事上部に固定する感じになっている</li></ul></li><li>個別記事ページでの別記事へのリンク<ul><li>前に書いた記事、次に書いた記事、最近書いた記事、（どうやるのがイメージ付いてないけど）関連記事あたり、のどれか</li></ul></li><li>ホームページのデザイン<ul><li>何か画像ドーンと置いてみたいなのやりたかったが、良い感じのものが思いつかなかったのでサブコンテンツにするつもりだった直近10件の記事リストだけになってる</li></ul></li><li>縦並び横並びで Flexbox を使いすぎた感あり、若干弄りにくさ出てきたのでその辺の整理</li><li>表示するタクソノミーとして tags と category をテンプレートにベタ書きしてるのでその辺の修正</li><li>公式テーマの申請<ul><li>README とか theme.toml とか諸々の整備</li><li>リポジトリ名もなんとかする必要ある</li></ul></li></ul><p>最終的には公式テーマとして申請したいとは思ってるものの、既存のテーマに比べると機能的に明らかに足りない感があるので、
その辺の充実が先かなとは思っている。</p><h2 id=作業を通しての感想>作業を通しての感想</h2><p>テーマを切り替えてデプロイするまでの作業をやった全体的な感想としてはこんな感じ</p><ul><li>HTML, CSS を弄って自分好みにデザインしていくのは何やかんや楽しい</li><li>Hugo のドキュメントとにらめっこしながら色々思考錯誤してテンプレート書くのもそれなりに楽しい</li><li>PageSpeed Insights とか評価ツールを回して改善していくのもサイト運営してる感があるので良い</li><li>作り始めると意外とやりたいことも色々出てくる</li></ul><p>総じて時間が溶けることを考慮しなければ楽しめている。
仕事みたいに期限が無いことや、趣味の個人サイトなので多少ミスってもそこまでダメージ無いというのも楽しめている要因だろうという気もする。</p><p>やり残したことは時間のあるタイミングでぼちぼちやっていければと良いなと思う。</p></section></article></main><aside class=article_aside_container><div class="article_meta_container card"><dl class=article_meta_list><div class="article_meta_item title"><dt class=article_meta_key><span>Title</span></dt><dd class=article_meta_value>Hugo のテーマを自作のものに切り替えた</dd></div><div class="article_meta_item timestamp"><dt class="article_meta_key has_icon icon_calendar"><span>Published</span></dt><dd class=article_meta_value><time class=published_date itemprop=datePublished datetime=2023-04-23T20:07:07+09:00>2023-04-23</time></dd></div><div class="article_meta_item taxonomy"><dt class="article_meta_key has_icon icon_tag"><span>Tags</span></dt><dd class=article_meta_value><ul class=taxonomy_list><li class=taxonomy_list_item><a class=taxonomy_button href=https://blog.shida-ws.net/tags/hugo/>Hugo</a></li></ul></dd></div></dl></div><div class="article_toc_container card"><div class=article_toc><div class=toc_header>Table of contents</div><div class=toc_body><nav id=TableOfContents><ul><li><a href=#作ったもの>作ったもの</a></li><li><a href=#進め方についての反省点>進め方についての反省点</a><ul><li><a href=#テスト用のサイトについて>テスト用のサイトについて</a></li><li><a href=#html-のシンタックス>HTML のシンタックス</a></li><li><a href=#機種依存の表示崩れのデバッグ>機種依存の表示崩れのデバッグ</a></li></ul></li><li><a href=#やり残したこと>やり残したこと</a></li><li><a href=#作業を通しての感想>作業を通しての感想</a></li></ul></nav></div></div></div></aside></div></div></div><footer class=site_footer_container><div class="footer_container content_area"><div class=footer_body>© 2022 shida.
Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and
<a href=https://github.com/goshida/hugo-theme/ rel="nofollow noopener" target=_blank>goshida/hugo-theme</a>.</div></div></footer></div></body></html>