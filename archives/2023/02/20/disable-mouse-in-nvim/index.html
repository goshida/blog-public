<!doctype html><html lang=ja><script async src="https://www.googletagmanager.com/gtag/js?id=G-Q4NDL34NBB"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Q4NDL34NBB")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,minimum-scale=1,user-scalable=yes"><title>Neovim でマウス操作を無効にする - SHIDALOG</title><meta name=author content="goshida"><meta name=description content="タイトル通り。"><meta name=generator content="Hugo 0.105.0"><meta property="og:title" content="Neovim でマウス操作を無効にする"><meta property="og:description" content="タイトル通り。"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.shida-ws.net/archives/2023/02/20/disable-mouse-in-nvim/"><meta property="article:section" content="archives"><meta property="article:published_time" content="2023-02-20T11:19:41+09:00"><meta property="article:modified_time" content="2023-02-20T11:19:41+09:00"><link rel=stylesheet href=https://blog.shida-ws.net/css/style.css><link rel=stylesheet href=https://blog.shida-ws.net/css/custom.css><body><div class=site_container><header class=site_header_container><div class="header_container content_area"><div class=header_body><div class=logo_container><div class=site_logo><a href=https://blog.shida-ws.net/>SHIDALOG</a></div><div class=site_tagline>備忘録的なもの</div></div><nav class=site_navigation_container><ul class=navigation_list><li class=navigation_item><a href=/archives/>Archives</a></li><li class=navigation_item><a href=/about/>About</a></li></ul></nav></div></div></header><div class=site_main_container><div class="single_container content_area"><div class=single_main_container itemscope itemtype=https://schema.org/BlogPosting><main class="article_main_container card"><article class=article_container><header class=article_header><h1 class=article_title itemprop=headline>Neovim でマウス操作を無効にする</h1></header><section class=article_body itemprop=articleBody><p>タイトル通り。</p><p>Neovim を使っているので一応このタイトルにしているが、特に Vim との違いとかって意図は無い。</p><p>自分は Linux でエディタとして Neovim 、デスクトップ環境として Xfce を使っているのだが、
フォーカスを切り替えるときにウィンドウ内の適当な場所をクリックして切り替えることが多い。</p><p>で、ブラウザで何かを調べながら、ターミナル（ Neovim ）で文章書いてたり設定ファイル弄るみたいなこともよくやっているが、
ターミナルをクリックしたときにカーソル位置がずれるのが結構ストレスになっていたので無効化した。</p><p>設定自体は１行なのだが、その1行を理解するために調べたこと。</p><h2 id=設定作業>設定作業</h2><p>ググれば記事は色々ヒットするが、実際やることとしてはそれらと同じで以下を設定ファイル（ <code>.config/nvim/init.vim</code> なり <code>.vimrc</code> なり）に足すだけ。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>set <span style=color:#79c0ff>mouse</span><span style=color:#ff7b72;font-weight:700>=</span>
</span></span></code></pre></div><h2 id=関連して調べたこと>関連して調べたこと</h2><h3 id=mouse-について>mouse について</h3><p>そもそもの mouse オプションについて。</p><p>mouse が何をしているオプションかというところから知らなかったので、ひとまず <code>:help mouse</code> を確認。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#a5d6ff>&#39;mouse&#39;</span>                 string  <span style=color:#ff7b72;font-weight:700>(</span>default <span style=color:#a5d6ff>&#34;nvi&#34;</span><span style=color:#ff7b72;font-weight:700>)</span>
</span></span><span style=display:flex><span>                        global
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Enables mouse support. For example, to enable the mouse in Normal mode
</span></span><span style=display:flex><span>        and Visual mode:
</span></span><span style=display:flex><span>                :set <span style=color:#79c0ff>mouse</span><span style=color:#ff7b72;font-weight:700>=</span>nv
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        To temporarily disable mouse support, hold the shift key <span style=color:#ff7b72>while</span> using
</span></span><span style=display:flex><span>        the mouse.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Mouse support can be enabled <span style=color:#ff7b72>for</span> different modes:
</span></span><span style=display:flex><span>                n       Normal mode
</span></span><span style=display:flex><span>                v       Visual mode
</span></span><span style=display:flex><span>                i       Insert mode
</span></span><span style=display:flex><span>                c       Command-line mode                
</span></span><span style=display:flex><span>                h       all previous modes when editing a help file
</span></span><span style=display:flex><span>                a       all previous modes
</span></span><span style=display:flex><span>                r       <span style=color:#ff7b72>for</span> hit-enter and more-prompt prompt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Left-click anywhere in a text buffer to place the cursor there.  This
</span></span><span style=display:flex><span>        works with operators too, e.g. type d <span style=color:#ff7b72>then</span> left-click to delete text
</span></span><span style=display:flex><span>        from the current cursor position to the position where you clicked.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Drag the status-line or vertical separator of a window to resize it.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        If enabled <span style=color:#ff7b72>for</span> <span style=color:#a5d6ff>&#34;v&#34;</span> <span style=color:#ff7b72;font-weight:700>(</span>Visual mode<span style=color:#ff7b72;font-weight:700>)</span> <span style=color:#ff7b72>then</span> double-click selects word-wise,
</span></span><span style=display:flex><span>        triple-click makes it line-wise, and quadruple-click makes it
</span></span><span style=display:flex><span>        rectangular block-wise.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        For scrolling with a mouse wheel see scroll-mouse-wheel.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        Note: When enabling the mouse in a terminal, copy/paste will use the
</span></span><span style=display:flex><span>        <span style=color:#a5d6ff>&#34;* register if possible. See also &#39;clipboard&#39;.
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        Related options:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#39;mousefocus&#39;    window focus follows mouse pointer
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#39;mousemodel&#39;    what mouse button does which action
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#39;mousehide&#39;     hide mouse pointer while typing text
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        &#39;selectmode&#39;    whether to start Select mode or Visual mode
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        The :behave command provides some &#34;</span>profiles<span style=color:#a5d6ff>&#34; for mouse behavior.
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                                                :behave :be
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>        :be[have] {model}       Set behavior for mouse and selection.  Valid
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                arguments are:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                   mswin        MS-Windows behavior
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                   xterm        Xterm behavior
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                Using &#34;</span>:behave<span style=color:#a5d6ff>&#34; changes these options:
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                option          mswin                   xterm
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                &#39;selectmode&#39;    &#34;</span>mouse,key<span style=color:#a5d6ff>&#34;             &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                &#39;mousemodel&#39;    &#34;</span>popup<span style=color:#a5d6ff>&#34;                 &#34;</span>extend<span style=color:#a5d6ff>&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                &#39;keymodel&#39;      &#34;</span>startsel,stopsel<span style=color:#a5d6ff>&#34;      &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#a5d6ff>                                &#39;selection&#39;     &#34;</span>exclusive<span style=color:#a5d6ff>&#34;             &#34;</span>inclusive<span style=color:#a5d6ff>&#34;
</span></span></span></code></pre></div><p>ということで、マウス操作を有効化するモードを指定するオプションだった。</p><p>（自分の環境だと）デフォルトが <code>mouse=nvi</code> になっているところを、<code>mouse=</code> （有効化するモード無し）とすることで、マウス操作を全モードで無効化する形。</p><p>ちなみに <code>mouse=</code> として全モードでマウス操作を無効化していても、ホイールスクロールは有効なままだった。
マウスを使った操作全般というよりは、ウィンドウ内のカーソル座標を使うイベントが mouse オプションでの有効無効の対象になっている感じだろうか。
ホイールスクロールについては特に困ってなかったので、それ以上は追わずそのままにしている。</p><p>余談だが、このヘルプ読んで Shirt キーとのコンビネーションで一時的に無効化できるということを初めて知った。</p><h3 id=mouse-a-について>mouse-=a について</h3><p>マウスの無効化の方法について調べていると、 <code>set mouse-=a</code> としている記事もいくつかあった。</p><p>mouse オプションでの指定から全てのモードを削除する、
と雰囲気で解釈した（ <code>chmod a-x</code> とかでの <code>-</code> と似たような感じ）のだが、自分の環境ではこれだと無効化されなかった。</p><p><code>-=</code> の理解が間違っているのかと思い一応 <code>:help set</code> を見ると以下の感じ。</p><div class=highlight><pre tabindex=0 style=color:#c9d1d9;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>:se<span style=color:#ff7b72;font-weight:700>[</span>t<span style=color:#ff7b72;font-weight:700>]</span> <span style=color:#ff7b72;font-weight:700>{</span>option<span style=color:#ff7b72;font-weight:700>}</span>-<span style=color:#ff7b72;font-weight:700>={</span>value<span style=color:#ff7b72;font-weight:700>}</span>                                :set-<span style=color:#ff7b72;font-weight:700>=</span>
</span></span><span style=display:flex><span>                        Subtract the <span style=color:#ff7b72;font-weight:700>{</span>value<span style=color:#ff7b72;font-weight:700>}</span> from a number option, or remove
</span></span><span style=display:flex><span>                        the <span style=color:#ff7b72;font-weight:700>{</span>value<span style=color:#ff7b72;font-weight:700>}</span> from a string option, <span style=color:#ff7b72>if</span> it is there.     
</span></span><span style=display:flex><span>                        If the <span style=color:#ff7b72;font-weight:700>{</span>value<span style=color:#ff7b72;font-weight:700>}</span> is not found in a string option, there
</span></span><span style=display:flex><span>                        is no error or warning.  When the option is a comma-
</span></span><span style=display:flex><span>                        separated list, a comma is deleted, unless the option
</span></span><span style=display:flex><span>                        becomes empty.                               
</span></span><span style=display:flex><span>                        When the option is a list of flags, <span style=color:#ff7b72;font-weight:700>{</span>value<span style=color:#ff7b72;font-weight:700>}</span> must be
</span></span><span style=display:flex><span>                        exactly as they appear in the option.  Remove flags
</span></span><span style=display:flex><span>                        one by one to avoid problems.               
</span></span><span style=display:flex><span>                        Also see :set-args above.
</span></span></code></pre></div><p>オプションの種類によって動きが違うが、以下のような処理をする演算子。</p><ul><li>オプションが数値<ul><li>与えられた数値分減算する</li></ul></li><li>オプションが文字列<ul><li>与えられた文字列が含まれている場合はそれを削除する</li><li>文字列がフラグのリストになっている場合は値の中に現れている通り正確に指定すること</li></ul></li></ul><p>デフォルトで <code>mouse=nvi</code> となっているところから、 <code>mouse-=a</code> で削除しようとしても <code>a</code> が値に含まれていないので <code>mouse=nvi</code> から変わらない。
（ <code>a</code> を全モードとして解釈してフラグを落としたりはしない）
ということで効かなかったらしい。</p><p>Neovim(Vim) のバージョンなのか使っているパッケージ（ディストリビューション）の設定なのかは分からないが、
場合によってはデフォルト値が <code>mouse=a</code> になっていて、その場合の記事だったのかもしれない。</p></section></article></main><aside class=article_aside_container><div class="article_meta_container card"><dl class=article_meta_list><div class="article_meta_item title"><dt class=article_meta_key><span>Title</span></dt><dd class=article_meta_value>Neovim でマウス操作を無効にする</dd></div><div class="article_meta_item timestamp"><dt class="article_meta_key has_icon icon_calendar"><span>Published</span></dt><dd class=article_meta_value><time class=published_date itemprop=datePublished datetime=2023-02-20T11:19:41+09:00>2023-02-20</time></dd></div><div class="article_meta_item taxonomy"><dt class="article_meta_key has_icon icon_tag"><span>Tags</span></dt><dd class=article_meta_value><ul class=taxonomy_list><li class=taxonomy_list_item><a class=taxonomy_button href=https://blog.shida-ws.net/tags/neovim/>Neovim</a></li></ul></dd></div></dl></div><div class="article_toc_container card"><div class=article_toc><div class=toc_header>Table of contents</div><div class=toc_body><nav id=TableOfContents><ul><li><a href=#設定作業>設定作業</a></li><li><a href=#関連して調べたこと>関連して調べたこと</a><ul><li><a href=#mouse-について>mouse について</a></li><li><a href=#mouse-a-について>mouse-=a について</a></li></ul></li></ul></nav></div></div></div></aside></div></div></div><footer class=site_footer_container><div class="footer_container content_area"><div class=footer_body>© 2022 shida.
Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and
<a href=https://github.com/goshida/hugo-theme/ rel="nofollow noopener" target=_blank>goshida/hugo-theme</a>.</div></div></footer></div></body></html>