<!doctype html><html class=no-js lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>ユーザセッションでロケールを変更する - SHIDALOG</title><script>(function(e,t){e[t]=e[t].replace("no-js","js")})(document.documentElement,"className")</script><meta name=description content><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class="container header__container"><div class=logo><a class=logo__link href=/ title=SHIDALOG rel=home><div class="logo__item logo__text"><div class=logo__title>SHIDALOG</div><div class=logo__tagline>個人的に調べたこと、考えたこと、やったことなど</div></div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>Menu</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/posts/><span class=menu__text>archive</span></a></li><li class=menu__item><a class=menu__link href=/about/><span class=menu__text>about</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>ユーザセッションでロケールを変更する</h1><div class="post__meta meta"><div class="meta__item-datetime meta__item"><svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg><time class=meta__text datetime=2023-03-16T19:03:53+09:00>2023-03-16</time></div></div></header><div class="post__toc toc"><div class=toc__title>Page content</div><div class=toc__menu><nav id=TableOfContents><ul><li><a href=#背景>背景</a></li><li><a href=#設定作業>設定作業</a><ul><li><a href=#ユーザディレクトリの設定>ユーザディレクトリの設定</a></li><li><a href=#ロケールの変更>ロケールの変更</a></li></ul></li><li><a href=#余談>余談</a><ul><li><a href=#xdg-user-dirs-を使う場合について>xdg-user-dirs を使う場合について</a></li><li><a href=#configlocaleconf-の読み込みタイミングについて>~/.config/locale.conf の読み込みタイミングについて</a></li></ul></li><li><a href=#おわりに>おわりに</a></li></ul></nav></div></div><div class="content post__content clearfix"><p>Linux でロケールとユーザディレクトリの設定を行う。</p><p>普段使っている Linux マシンのロケールとして <code>en_US.UTF-8</code> を設定していたのだが、
<code>ja_JP.UTF-8</code> に変えたのでその記録。</p><h2 id=背景>背景</h2><p>一応ロケール設定を変えようと思った背景について触れておく。</p><p>そもそもなんで <code>en_US.UTF-8</code> を使っていたのかという部分だが、以下2つが主な理由。</p><ul><li>最初に ArchLinux を使い初めた頃日本語化まわりでのトラブルを避けたくて英語にしたのを引きずっていた</li><li>ホームディレクトリにある各種ユーザディレクトリ（ <code>Downloads</code> とか <code>Desktop</code> とか）を英語にしておきたかった</li></ul><p>副作用としてデスクトップ環境やウェブブラウザ等のあらゆるソフトウェアの言語設定も英語になっていたが、
それほど困っていなかったのでしばらくそのままで使っていた。</p><p>ただ、しばらく使ってるとやっぱり日本語にしたいと思うことが増えてきた。</p><ul><li>ブラウザの言語設定を参照して、コンテンツが全部英語になるサイトが結構ある<ul><li>メニュー等の単語熟語程度ならともかく、文章だと Deepl とか英和時点のお世話になることも多いので読むのに時間かかる</li><li>最初は英語の勉強にもなるし良いかとも思ってたがやっぱり面倒になってきた</li></ul></li><li>GIMP とか慣れてないソフトは日本語の解説記事とかを見ながら操作することも多いので日本語の方が楽<ul><li>解説記事内の日本語項目に対応するものを英語で探して「どれやねん」となることがぼちぼちあった</li></ul></li><li>やっぱり英語より日本語の方がパッと見たときの視認性が高い<ul><li>単純に自分の英語力が足りてないんだろうという気はする</li></ul></li></ul><p>また、ArchLinux をしばらく使って慣れてきたこともあって、最初に英語ロケールにしておく必要性も薄れてきていた。</p><ul><li>日本語関連で面倒な事にはそうそうなることなさそうという感覚になった<ul><li>仮に何かあっても解決できるだろうという自信が付いたのもある</li></ul></li><li>ユーザディレクトリの名前もロケール設定とは別で制御できると分かったこと</li></ul><p>ということで今回の作業に至る。</p><h2 id=設定作業>設定作業</h2><p>作業としては、ユーザディレクトリの設定をした上でロケールの設定を変えるという順番でやる。</p><p>最終的に以下のような状態にする。</p><ul><li>ロケール<ul><li>システムロケールは英語を維持</li><li>ユーザロケールは日本語に変更</li></ul></li><li>ユーザディレクトリ<ul><li>ディレクトリ名は英語を維持</li></ul></li></ul><p>基本的には今の状態を維持しつつ、ユーザロケールだけ日本語に変える感じ。</p><p>システムログとかはググるときに日本語より英語でググったほうが情報多そうな気がするので、
システムロケールは英語を維持することにした。</p><h3 id=ユーザディレクトリの設定>ユーザディレクトリの設定</h3><p>まずはユーザディレクトリの名前を英語に固定する方から。</p><p>設定については freedesktop.org の wiki と、例によって ArchWiki のお世話になった。</p><ul><li><a href=https://www.freedesktop.org/wiki/Software/xdg-user-dirs/>xdg-user-dirs</a></li><li><a href=https://wiki.archlinux.jp/index.php/XDG_%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA>XDG ユーザーディレクトリ - ArchWiki</a></li></ul><p>ユーザディレクトリの管理には ArchWiki に書いてる様に xdg-user-dirs パッケージを使う事もできるが、
このツールはあくまで設定を生成したりローカライズを助けるためのモノなので使わなくても設定はできる。</p><p>（というより、自分の場合事前にディレクトリを一式作らせたくなくて、
その場合 xdg-user-dirs を使うと追加で設定が必要になってくるので使わない。この辺は後述）</p><p>freedesktop.org の仕様に沿うソフトウェアであれば、
各種ユーザディレクトリが必要になった場合 <code>${XDG_CONFIG_HOME}/user-dirs.dirs</code> を参照するので、
単純にこれを作れば良い。</p><p>今回の様に英語ロケールでのデフォルト設定を維持したいのであればこんな感じ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>XDG_DESKTOP_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Desktop&#34;</span>
</span></span><span style=display:flex><span>XDG_DOWNLOAD_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Downloads&#34;</span>
</span></span><span style=display:flex><span>XDG_TEMPLATES_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Templates&#34;</span>
</span></span><span style=display:flex><span>XDG_PUBLICSHARE_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Public&#34;</span>
</span></span><span style=display:flex><span>XDG_DOCUMENTS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Documents&#34;</span>
</span></span><span style=display:flex><span>XDG_MUSIC_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Music&#34;</span>
</span></span><span style=display:flex><span>XDG_PICTURES_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Pictures&#34;</span>
</span></span><span style=display:flex><span>XDG_VIDEOS_DIR<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/Videos&#34;</span>
</span></span></code></pre></div><p>一応ホントにこのファイルを参照しているかについては、
XDG_DOWNLOAD_DIR の値を適当なものに弄ってみるのが手っ取り早い。
ファイル編集後に適当なウェブブラウザで何かダウンロードリンク踏むと、
ダウンロード先のディレクトリが変わるのが確認できるはず。（要ブラウザ再起動）</p><p>ファイルを一個作っただけではあるが、これでユーザディレクトリを英語名で固定することができる。</p><h3 id=ロケールの変更>ロケールの変更</h3><p>ユーザディレクトリを英語名で固定できたので、次にロケールの設定を変更する。</p><p>自分の場合 OS インストール時に以下ファイルを作成して、システムロケールを設定している。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/locale.conf
</span></span><span style=display:flex><span>LANG<span style=color:#f92672>=</span>en_US.UTF-8
</span></span></code></pre></div><p>ユーザセッションで別のロケールを使いたい場合は、 <code>localegen</code> で使いたいロケールを生成した上で、
<code>${XDG_CONFIG_HOME}/locale.conf</code> にファイルを作成することでシステムロケールを上書きできる。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ grep -v <span style=color:#e6db74>&#39;^#&#39;</span> /etc/locale.gen
</span></span><span style=display:flex><span>en_US.UTF-8 UTF-8
</span></span><span style=display:flex><span>ja_JP.UTF-8 UTF-8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ sudo locale-gen
</span></span><span style=display:flex><span>Generating locales...
</span></span><span style=display:flex><span>  en_US.UTF-8... <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    ja_JP.UTF-8... <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>    Generation complete.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ locale -a
</span></span><span style=display:flex><span>C
</span></span><span style=display:flex><span>C.UTF-8
</span></span><span style=display:flex><span>POSIX
</span></span><span style=display:flex><span>en_US.utf8
</span></span><span style=display:flex><span>ja_JP.utf8
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ echo <span style=color:#e6db74>&#39;LANG=ja_JP.UTF-8&#39;</span> &gt;&gt; ~/.config/locale.conf
</span></span></code></pre></div><p>あと若干おま環気味なので詳細は後述するが、自分の環境ではこのファイルを読み込む処理を <code>.profile</code> に追記している。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat ~/.profile
</span></span><span style=display:flex><span>...<span style=color:#f92672>(</span>略<span style=color:#f92672>)</span>...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> -r <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>/locale.conf&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  . <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>/locale.conf&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><p>そうすると再ログイン以降、メニューなどが日本語で表示されることが確認できる。</p><figure><a href=/posts/2023/03/16/override-locale-in-user-session/images/before.png target=_self><img src=/posts/2023/03/16/override-locale-in-user-session/images/before_hub060c243becd6bba814ec8d61c0a8ac8_23926_400x400_fit_box_3.png alt="ロケール変更前の Xfce メニュー"></a><figcaption>作業前</figcaption></figure><figure><a href=/posts/2023/03/16/override-locale-in-user-session/images/after.png target=_self><img src=/posts/2023/03/16/override-locale-in-user-session/images/after_hu4fb7c4394b51831784bee9f83887aee9_25965_400x400_fit_box_3.png alt="ロケール変更後の Xfce メニュー"></a><figcaption>作業後</figcaption></figure><h2 id=余談>余談</h2><h3 id=xdg-user-dirs-を使う場合について>xdg-user-dirs を使う場合について</h3><p>ユーザディレクトリの設定について、今回は使わないことにしたが
xdg-user-dirs を使ったパターンでも試したのでその場合の設定についても残しておく。</p><p>必要に応じてパッケージをインストールする。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo pacman -S xdg-user-dirs
</span></span></code></pre></div><p>すると <code>/etc/</code> にシステムのデフォルト設定もインストールされる。
大した分量でも無いし、設定ファイルのコメントに必要なことは大体書いてる感じなので目を通しておくと良さげ。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ pacman -Ql xdg-user-dirs | grep -v <span style=color:#e6db74>&#39;/$&#39;</span> | grep <span style=color:#e6db74>&#39;/etc/&#39;</span>
</span></span><span style=display:flex><span>xdg-user-dirs /etc/xdg/user-dirs.conf
</span></span><span style=display:flex><span>xdg-user-dirs /etc/xdg/user-dirs.defaults
</span></span></code></pre></div><details><summary>一応自分がインストールした際(ver. 0.18-1 )の中身を貼っておく</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/xdg/user-dirs.conf
</span></span><span style=display:flex><span><span style=color:#75715e># This controls the behaviour of xdg-user-dirs-update which is run on user login</span>
</span></span><span style=display:flex><span><span style=color:#75715e># You can also have per-user config in ~/.config/user-dirs.conf, or specify</span>
</span></span><span style=display:flex><span><span style=color:#75715e># the XDG_CONFIG_HOME and/or XDG_CONFIG_DIRS to override this</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>enabled<span style=color:#f92672>=</span>True
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># This sets the filename encoding to use. You can specify an explicit</span>
</span></span><span style=display:flex><span><span style=color:#75715e># encoding, or &#34;locale&#34; which means the encoding of the users locale</span>
</span></span><span style=display:flex><span><span style=color:#75715e># will be used</span>
</span></span><span style=display:flex><span>filename_encoding<span style=color:#f92672>=</span>UTF-8
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/xdg/user-dirs.defaults
</span></span><span style=display:flex><span><span style=color:#75715e># Default settings for user directories</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#</span>
</span></span><span style=display:flex><span><span style=color:#75715e># The values are relative pathnames from the home directory and</span>
</span></span><span style=display:flex><span><span style=color:#75715e># will be translated on a per-path-element basis into the users locale</span>
</span></span><span style=display:flex><span>DESKTOP<span style=color:#f92672>=</span>Desktop
</span></span><span style=display:flex><span>DOWNLOAD<span style=color:#f92672>=</span>Downloads
</span></span><span style=display:flex><span>TEMPLATES<span style=color:#f92672>=</span>Templates
</span></span><span style=display:flex><span>PUBLICSHARE<span style=color:#f92672>=</span>Public
</span></span><span style=display:flex><span>DOCUMENTS<span style=color:#f92672>=</span>Documents
</span></span><span style=display:flex><span>MUSIC<span style=color:#f92672>=</span>Music
</span></span><span style=display:flex><span>PICTURES<span style=color:#f92672>=</span>Pictures
</span></span><span style=display:flex><span>VIDEOS<span style=color:#f92672>=</span>Videos
</span></span><span style=display:flex><span><span style=color:#75715e># Another alternative is:</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#MUSIC=Documents/Music</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#PICTURES=Documents/Pictures</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#VIDEOS=Documents/Videos</span>
</span></span></code></pre></div></details><br><p>ユーザディレクトリの指定としては xdg-user-dirs を使わない場合と同じような感じで、
<code>${XDG_CONFIG_HOME}/user-dirs.dirs</code> にファイルを作成する。
（xdg-user-dirs を使わないパターンと指定方法が若干違うが、絶対パス or ホームディレクトリからの相対パスでどっちでも良い）</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>DESKTOP<span style=color:#f92672>=</span>Desktop
</span></span><span style=display:flex><span>DOWNLOAD<span style=color:#f92672>=</span>Downloads
</span></span><span style=display:flex><span>TEMPLATES<span style=color:#f92672>=</span>Templates
</span></span><span style=display:flex><span>PUBLICSHARE<span style=color:#f92672>=</span>Public
</span></span><span style=display:flex><span>DOCUMENTS<span style=color:#f92672>=</span>Documents
</span></span><span style=display:flex><span>MUSIC<span style=color:#f92672>=</span>Music
</span></span><span style=display:flex><span>PICTURES<span style=color:#f92672>=</span>Pictures
</span></span><span style=display:flex><span>VIDEOS<span style=color:#f92672>=</span>Videos
</span></span></code></pre></div><p>また xdg-user-dirs は（少なくとも ArchLinux のパッケージの）デフォルト設定だと、
ユーザログイン時に xdg-user-dirs-update を実行して各種ディレクトリがない場合自動で作成する設定になっている。
自分の場合 <code>~/Public/</code> や <code>~/Templates/</code> 等の使わない空ディレクトリを作られたくないので、ログイン時に実行されない様にしておく。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ sudo sed -i -e <span style=color:#e6db74>&#39;s/enabled=True/enabled=False/&#39;</span> /etc/xdg/user-dirs.conf
</span></span></code></pre></div><p>という感じで、今回設定したのと同じ状態にできる。</p><p>実は先にこっちの方法で設定したのだが、
インストールした上でわざわざ実行しない設定を足すくらいならインストール自体必要ないか、
という事で最終的に xdg-user-dirs パッケージは使わないことにした。</p><h3 id=configlocaleconf-の読み込みタイミングについて>~/.config/locale.conf の読み込みタイミングについて</h3><p>ユーザセッションでのロケール設定について、最初は ArchWiki に書いてる通り単純に <code>~/.config/locale.conf</code> を作ったのだが、
それだけだと反映されずなんでだろうかと調べていた。</p><p>若干腑に落ちきっていないところはあるのだが、
結果から言うと systemd と自分が使っているディスプレイマネージャ（ lightdm ）のデフォルト設定との噛み合わせが悪そう、
という感じだった。</p><p>まず lightdm ではセッションのラッパースクリプト内で <code>/etc/locale.conf</code> <code>~/.config/locale.conf</code> などを読み込んでいるのだが、
デフォルトのスクリプトだと LANG 変数がセットされていない場合にのみ読み込むようになっている。</p><details><summary>若干冗長な気もするので畳むが、一応該当部分を貼っておく</summary><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/lightdm/lightdm.conf | grep -v -e <span style=color:#e6db74>&#39;^#&#39;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>LightDM<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>run-directory<span style=color:#f92672>=</span>/run/lightdm
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Seat:*<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>session-wrapper<span style=color:#f92672>=</span>/etc/lightdm/Xsession
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>XDMCPServer<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>VNCServer<span style=color:#f92672>]</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/lightdm/Xsession | grep -A6 -e <span style=color:#e6db74>&#34;Load profile&#34;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load profile</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> file in <span style=color:#e6db74>&#34;/etc/profile&#34;</span> <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.profile&#34;</span> <span style=color:#e6db74>&#34;/etc/xprofile&#34;</span> <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.xprofile&#34;</span>; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -f <span style=color:#e6db74>&#34;</span>$file<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        echo <span style=color:#e6db74>&#34;Loading profile from </span>$file<span style=color:#e6db74>&#34;</span>;
</span></span><span style=display:flex><span>        . <span style=color:#e6db74>&#34;</span>$file<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>done</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>cat /etc/profile | grep -A6 <span style=color:#e6db74>&#39;Load profiles&#39;</span>
</span></span><span style=display:flex><span><span style=color:#75715e># Load profiles from /etc/profile.d</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> test -d /etc/profile.d/; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> profile in /etc/profile.d/*.sh; <span style=color:#66d9ef>do</span>
</span></span><span style=display:flex><span>                test -r <span style=color:#e6db74>&#34;</span>$profile<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>&amp;&amp;</span> . <span style=color:#e6db74>&#34;</span>$profile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>done</span>
</span></span><span style=display:flex><span>        unset profile
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ cat /etc/profile.d/locale.sh
</span></span><span style=display:flex><span><span style=color:#75715e>#!/bin/sh</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># load locale.conf in XDG paths.</span>
</span></span><span style=display:flex><span><span style=color:#75715e># /etc/locale.conf loads and overrides by kernel command line is done by systemd</span>
</span></span><span style=display:flex><span><span style=color:#75715e># But we override it here, see FS#56688</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -z <span style=color:#e6db74>&#34;</span>$LANG<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> -r <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>/locale.conf&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    . <span style=color:#e6db74>&#34;</span>$XDG_CONFIG_HOME<span style=color:#e6db74>/locale.conf&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> -n <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>[</span> -r <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.config/locale.conf&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    . <span style=color:#e6db74>&#34;</span>$HOME<span style=color:#e6db74>/.config/locale.conf&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>elif</span> <span style=color:#f92672>[</span> -r /etc/locale.conf <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    . /etc/locale.conf
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># define default LANG to C if not already defined</span>
</span></span><span style=display:flex><span>LANG<span style=color:#f92672>=</span><span style=color:#e6db74>${</span>LANG<span style=color:#66d9ef>:-</span>C<span style=color:#e6db74>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># export all locale (7) variables when they exist</span>
</span></span><span style=display:flex><span>export LANG LANGUAGE LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       LC_MESSAGES LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>       LC_IDENTIFICATION
</span></span></code></pre></div></details><br><p>ただ、 <code>/etc/locale.conf</code> に関しては systemd での起動時どこか早いタイミングで別途読み込みが行われているらしく、
lightdm のラッパースクリプトを実行するタイミングで既に LANG 変数がセットされているため、
読み込み処理が行われないような感じになっていた。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>$ PAGER<span style=color:#f92672>=</span>cat man locale.conf | head -10
</span></span><span style=display:flex><span>LOCALE.CONF<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>                                                 locale.conf                                                LOCALE.CONF<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>NAME
</span></span><span style=display:flex><span>       locale.conf - Configuration file <span style=color:#66d9ef>for</span> locale settings
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>SYNOPSIS
</span></span><span style=display:flex><span>       /etc/locale.conf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>DESCRIPTION
</span></span><span style=display:flex><span>       The /etc/locale.conf file configures system-wide locale settings. It is read at early boot by systemd<span style=color:#f92672>(</span>1<span style=color:#f92672>)</span>.
</span></span></code></pre></div><p>どうするか少し悩んだが、最終的には前述の設定作業の通り <code>~/.profile</code> に
LANG 変数の状態を問わず <code>~/.config/locale.conf</code> があれば読み込むような処理を追加して解消した。</p><p>具体的に <code>/etc/locale.conf</code> を読み込んでいる箇所については、
気が向いたときにでももう少し調べてみようと思う。（調べなさそう）</p><h2 id=おわりに>おわりに</h2><p>冒頭の背景の通り、英語ロケールでのデメリットが気になってきたので今回日本語ロケールに変更したが、
日本語ロケール故に気になることもあるかもなとは思っている。</p><p>例えば、ソフトによって日本語対応してないものもあるだろうとは思っているが、
メニューが日本語だったり英語だったりするのがどの程度気になるか、とか。</p><p>それ以外にも不満点が出てくるかも知れないが、しばらく使ってみて気になるようならまた英語ロケールに戻すかもとは思っている。
（今回色々調べたおかげで、次は <code>~/.config/locale.conf</code> を修正するだけで良くなったはず）</p></div><footer class=post__footer><div class="post__tags tags clearfix"><svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5.0 11V3C0 1.5.8.8.8.8S1.5.0 3 0h8c1.5.0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 100-6 3 3 0 000 6z"/></svg><ul class=tags__list><li class=tags__item><a class="tags__link btn" href=/tags/linux/ rel=tag>Linux</a></li></ul></div></footer></article></main></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=SEARCH… name=q aria-label=SEARCH…></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=https://blog.shida-ws.net/></form></div><div class="widget-recent widget"><h4 class=widget__title>Recent Posts</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/posts/2023/03/16/override-locale-in-user-session/>ユーザセッションでロケールを変更する</a></li><li class=widget__item><a class=widget__link href=/posts/2023/03/02/create-a-hugo-theme/>Hugo のテーマ自作ことはじめ</a></li><li class=widget__item><a class=widget__link href=/posts/2023/02/20/disable-mouse-in-nvim/>Neovim でマウス操作を無効にする</a></li><li class=widget__item><a class=widget__link href=/posts/2023/02/12/configure-wireguard-based-on-nmcli/>nmcli を用いた WireGuard の設定</a></li><li class=widget__item><a class=widget__link href=/posts/2023/02/04/static-ip-settings-by-nmcli/>nmcli を使って固定 IP アドレスの設定を行う</a></li><li class=widget__item><a class=widget__link href=/posts/2023/01/15/steam-play-on-archlinux/>Arch Linux で Steam Play ( Proton ) を試す</a></li><li class=widget__item><a class=widget__link href=/posts/2022/12/23/use-reflector-to-select-archlinux-mirrorlist/>Arch Linux のミラーリストの設定に reflector を使う</a></li><li class=widget__item><a class=widget__link href=/posts/2022/11/18/capslock-as-ctrl-in-xkb-configuration/>XKB の設定で capslock を ctrl として使えるようにする</a></li><li class=widget__item><a class=widget__link href=/posts/2022/11/08/hugo-image-processing-for-thumbnail/>Hugo の Image Processing を使ってサムネイルを生成する</a></li><li class=widget__item><a class=widget__link href=/posts/2022/10/28/implement-baguettebox-js-in-hugo/>Hugo に baguetteBox.js を埋め込む</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>Tags</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/arch-linux/ title="Arch Linux">Arch Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/github/ title=GitHub>GitHub</a>
<a class="widget-taglist__link widget__link btn" href=/tags/google-search-console/ title="Google Search Console">Google Search Console</a>
<a class="widget-taglist__link widget__link btn" href=/tags/hugo/ title=Hugo>Hugo</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/neovim/ title=Neovim>Neovim</a>
<a class="widget-taglist__link widget__link btn" href=/tags/steam/ title=Steam>Steam</a>
<a class="widget-taglist__link widget__link btn" href=/tags/vpn/ title=VPN>VPN</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E3%82%B2%E3%83%BC%E3%83%A0/ title=ゲーム>ゲーム</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E3%83%96%E3%83%AD%E3%82%B0/ title=ブログ>ブログ</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%86%99%E7%B5%8C/ title=写経>写経</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E9%9B%91%E8%A8%98/ title=雑記>雑記</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">Social</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/goshida target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2C329 348.2 384 276.4 384 191.7 384 85.8 298 0 192 0z"/></svg><span>GitHub</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2023 shida.
<span class=footer__copyright-credits>Generated with <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> and <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a> theme.</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>